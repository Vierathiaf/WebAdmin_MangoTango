<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Login - MangoTango</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body.admin-login-page {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px;
      display: grid;
      grid-template-columns: 1fr 500px;
      gap: 80px;
      align-items: center;
    }

    .login-hero {
      color: white;
    }

    .login-hero h1 {
      font-size: 42px;
      font-weight: 800;
      margin-bottom: 20px;
      line-height: 1.2;
    }

    .login-hero p {
      font-size: 18px;
      opacity: 0.9;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .security-features {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 30px;
    }

    .security-item {
      display: flex;
      align-items: center;
      color: white;
      font-size: 16px;
    }

    .security-item::before {
      content: "üîí";
      margin-right: 10px;
      font-size: 18px;
    }

    .login-panel {
      background: white;
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.25), 0 10px 30px rgba(0, 0, 0, 0.15);
      position: relative;
      overflow: hidden;
      max-height: 550px;
      backdrop-filter: blur(10px);
    }

    .login-panel::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }

    .login-header {
      text-align: center;
      margin-bottom: 15px;
      /* reduced */
      margin-top: -10px;
      /* pulls logo upward, fixes spacing */
    }

    .login-logo {
      width: 110px;
      /* bigger & professional */
      height: 110px;
      margin-bottom: 1px;
      /* tighter spacing between logo & title */
    }S


    .login-title {
      font-size: 28px;
      font-weight: 800;
      color: #06235d4e;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .login-subtitle {
      color: #718096;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 6px;
      font-size: 14px;
    }

    .form-group input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 15px;
      transition: all 0.3s ease;
      box-sizing: border-box;
      background: #f8fafc;
    }

    .form-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.12);
      background: white;
    }

    .password-wrapper {
      position: relative;
      width: 100%;
    }

    .password-wrapper input {
      padding-right: 50px;
    }

    .toggle-password {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      padding: 6px;
      color: #718096;
      transition: color 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
    }

    .toggle-password:hover {
      color: #667eea;
    }

    .toggle-password:focus {
      outline: none;
      color: #667eea;
    }

    .toggle-password svg {
      width: 20px;
      height: 20px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .checkbox-wrapper {
      margin-bottom: 30px;
      /* adds space before the login button */
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      /* centers checkbox and text vertically */
      gap: 8px;
      /* space between checkbox and label */
    }

    .checkbox-container input[type="checkbox"] {
      width: 16px;
      height: 16px;
      margin: 0;
      cursor: pointer;
    }

    .checkbox-container label {
      margin: 0;
      font-size: 14px;
      color: #4a5568;
      cursor: pointer;
      line-height: 1;
      font-weight: 600;
    }

    .remember-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 28px;
      padding-left: 4px;
      width: 100%;
    }

    .remember-container input[type="checkbox"] {
      width: 16px;
      height: 16px;
      margin: 0;
      cursor: pointer;
      accent-color: #667eea;
      flex-shrink: 0;
    }

    .remember-container label {
      font-size: 14px;
      color: #4a5568;
      margin: 0;
      line-height: 1;
      cursor: pointer;
      font-weight: 500;
    }


    .login-button {
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
    }

    .login-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .login-button:hover::before {
      left: 100%;
    }

    .login-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      background: linear-gradient(135deg, #7c8ff0 0%, #8a5bb8 100%);
    }

    .login-button:active {
      transform: translateY(-1px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
    }

    .forgot-link {
      text-align: center;
    }

    .forgot-link a {
      color: #667eea;
      text-decoration: none;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .forgot-link a:hover {
      color: #764ba2;
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .login-container {
        grid-template-columns: 1fr;
        gap: 40px;
        padding: 20px;
      }

      .login-panel {
        padding: 25px;
        max-height: none;
      }

      .login-hero {
        text-align: center;
      }

      .login-hero h1 {
        font-size: 32px;
      }

      .security-features {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body class="admin-login-page">
  <div class="login-container">
    <!-- Login Hero Section -->
    <div class="login-hero">
      <h1>Secure Admin<br>Access Portal</h1>
      <p>
        MangoTango Development Administration Dashboard.
        Manage technicians, analytics, and system operations with enterprise grade security.
      </p>

      <div class="security-features">
        <div class="security-item">Multi-factor Authentication</div>
        <div class="security-item">Encrypted Sessions</div>
        <div class="security-item">Audit Logging</div>
        <div class="security-item">Role-based Access</div>
      </div>
    </div>

    <!-- Login Panel -->
    <div class="login-panel">
      <div class="login-header">
        <img src="images/mango.png" class="login-logo" alt="MangoTango Logo">
        <h2 class="login-title">Admin Login</h2>
        <p class="login-subtitle">Enter your credentials to access the dashboard</p>
      </div>

      <form id="loginForm">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" value="mangotangodev.ph@gmail.com" required>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="password-wrapper">
            <input type="password" id="password" placeholder="Enter your password" required>
            <button type="button" class="toggle-password" id="togglePassword" aria-label="Toggle password visibility">
              <svg id="eyeIcon" viewBox="0 0 24 24">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
          </div>
        </div>

        <div class="remember-container">
          <input type="checkbox" id="remember">
          <label for="remember">Remember me</label>
        </div>

        <button type="submit" class="login-button">
          Log In
        </button>
      </form>

      <div class="forgot-link">
        <a href="forgot.html">Forgot your password?</a>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      setPersistence, 
      browserSessionPersistence,
      inMemoryPersistence
    } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';

    // Initialize Firebase with error handling
    try {
      const firebaseConfig = {
        apiKey: "AIzaSyCop9FnqrMS7zDmBruG1IH9S-EZhc6sexk",
        authDomain: "mangotango-mobile.firebaseapp.com",
        databaseURL: "https://mangotango-mobile-default-rtdb.firebaseio.com",
        projectId: "mangotango-mobile",
        storageBucket: "mangotango-mobile.appspot.com",
        messagingSenderId: "85435573414",
        appId: "1:85435573414:web:37fb969be0df109a974067",
        measurementId: "G-E2TX3PEMFY"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      
      // Set persistence with fallback to in-memory if IndexedDB fails
      const setPersistenceWithFallback = async () => {
        try {
          await setPersistence(auth, browserSessionPersistence);
          console.log('Using browser session persistence');
        } catch (error) {
          console.warn("Could not set browser session persistence, falling back to in-memory:", error);
          try {
            await setPersistence(auth, inMemoryPersistence);
            console.log('Using in-memory persistence as fallback');
          } catch (fallbackError) {
            console.error("Failed to set any persistence:", fallbackError);
            // Continue without setting persistence
          }
        }
      };
      
      // Initialize persistence
      setPersistenceWithFallback();

      const loginForm = document.getElementById("loginForm");
      
      // Check if user is already logged in
      auth.onAuthStateChanged((user) => {
        if (user && user.email === "mangotangodev.ph@gmail.com") {
          console.log("‚úÖ User already logged in, redirecting...");
          window.location.href = "dashboard.html";
        }
      });

      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const loginButton = document.querySelector('button[type="submit"]');
        
        // Clear any previous errors
        const existingError = document.querySelector('.error-message');
        if (existingError) existingError.remove();
        
        // Basic validation
        if (!email || !password) {
          showError("Please enter both email and password");
          return;
        }
        
        if (email !== "mangotangodev.ph@gmail.com") {
          showError("Access denied. Admin credentials required.");
          return;
        }

        try {
          loginButton.disabled = true;
          loginButton.textContent = 'Signing in...';
          
          // Try with regular sign-in first
          try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            console.log("‚úÖ Login successful");
            window.location.href = "dashboard.html";
            return;
          } catch (signInError) {
            console.log("Regular sign-in failed, trying with in-memory persistence:", signInError);
            
            // If regular sign-in fails, try with in-memory persistence
            try {
              await setPersistence(auth, inMemoryPersistence);
              const userCredential = await signInWithEmailAndPassword(auth, email, password);
              console.log("‚úÖ Login successful with in-memory persistence");
              window.location.href = "dashboard.html";
              return;
            } catch (memoryError) {
              // If we get here, both attempts failed
              console.error("‚ùå Both login attempts failed:", memoryError);
              throw memoryError; // This will be caught by the outer catch block
            }
          }
        } catch (error) {
          console.error("‚ùå Login error:", error);
          let errorMessage = "Login failed. Please try again.";
          
          switch(error.code) {
            case 'auth/user-not-found':
              errorMessage = "No account found with this email.";
              break;
            case 'auth/wrong-password':
              errorMessage = "Incorrect password. Please try again.";
              break;
            case 'auth/too-many-requests':
              errorMessage = "Too many failed attempts. Please try again later.";
              break;
            case 'auth/network-request-failed':
              errorMessage = "Network error. Please check your connection.";
              break;
          }
          
          showError(errorMessage);
        } finally {
          loginButton.disabled = false;
          loginButton.textContent = 'Log In';
        }
      });
      
      // Show error message to user
      function showError(message) {
        // Remove any existing error messages
        const existingError = document.querySelector('.error-message');
        if (existingError) existingError.remove();
        
        const errorElement = document.createElement('div');
        errorElement.className = 'error-message';
        errorElement.style.color = '#e53e3e';
        errorElement.style.marginTop = '10px';
        errorElement.style.textAlign = 'center';
        errorElement.textContent = message;
        
        const form = document.getElementById('loginForm');
        form.appendChild(errorElement);
      }
      
      // Password toggle functionality
      const togglePassword = document.getElementById('togglePassword');
      const passwordInput = document.getElementById('password');
      const eyeIcon = document.getElementById('eyeIcon');

      if (togglePassword && passwordInput && eyeIcon) {
        togglePassword.addEventListener('click', function () {
          const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
          passwordInput.setAttribute('type', type);

          // Toggle eye icon
          if (type === 'password') {
            eyeIcon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
          } else {
            eyeIcon.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
          }
        });
      }
      
    } catch (error) {
      console.error("üî• Critical Firebase initialization error:", error);
      document.body.innerHTML = `
        <div style="padding: 20px; color: #e53e3e; font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; text-align: center;">
          <h2>Application Error</h2>
          <p>Failed to initialize the application. Please try the following:</p>
          <ol style="text-align: left; max-width: 400px; margin: 20px auto;">
            <li>Refresh the page (Press F5 or Ctrl+R)</li>
            <li>Clear your browser cache and try again</li>
            <li>Try using a different browser</li>
            <li>Contact support if the problem persists</li>
          </ol>
          <p><small>Error: ${error.message}</small></p>
        </div>`;
    }
  </script>
</body>

</html>